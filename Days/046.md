# Deploy a Two tier App on Docker Containers

The Nautilus Application development team recently finished development of one of the apps that they want to deploy on a containerized platform. The Nautilus Application development and DevOps teams met to discuss some of the basic pre-requisites and requirements to complete the deployment. The team wants to test the deployment on one of the app servers before going live and set up a complete containerized stack using a docker compose fie. Below are the details of the task:

- On App Server 2 in Stratos Datacenter create a docker compose file `/opt/finance/docker-compose.yml`. (should be named exactly)

- The compose should deploy two services (web and DB), and each service should deploy a container as per details below:

For web service:

- Container name must be `php_host`.
- Use image `php` with any apache tag. Check [docker hub](https://hub.docker.com/_/php?tab=tags/) for more details.
- Map php_web container's port `80` with host port `8084`
- Map php_web container's `/var/www/html` volume with host volume `/var/www/html`.

For DB service:

- Container name must be `mysql_host`.
- Use image `mariadb` with any tag (preferably latest). Check [mariadb](https://hub.docker.com/_/mariadb?tab=tags/) for more details.
- Map mysql_web container's port `3306` with host port `3306`
- Map mysql_web container's `/var/lib/mysql` volume with host volume `/var/lib/mysql`.
- Set `MYSQL_DATABASE=database_host` and use any custom user ( except root ) with some complex password for DB connections.

After running docker-compose up you can access the app with curl command curl `<server-ip or hostname>:8084/`

For more details check [mariadb](https://hub.docker.com/_/mariadb?tab=description/).

Note: Once you click on FINISH button, all currently running/stopped containers will be destroyed and stack will be deployed again using your compose file.

## Steps

In this daily challenge, we are going to dockerized a 2-tier application. We have to create a docker compose file bundled with frontend and database containers. let's start...

1. Login into App Server 2
2. Create a docker compose file

    ```sh
    sudo vi /opt/finance/docker-compose.yml
    ```

3. Copy-paste the following contents inside `/opt/finance/docker-compose.yml`

    ```yaml
    services:
      web:
        image: php:7.2-apache
        container_name: php_host
        ports:
          - 8084:80
        volumes:
          - /var/www/html:/var/www/html
    
      db:
        image: mariadb:latest
        container_name: mysql_host
        environment:
          MYSQL_DATABASE: database_host
          MYSQL_USER: admin
          MYSQL_PASSWORD: admin
          MYSQL_ROOT_PASSWORD: admin
        ports:
          - 3306:3306
        volumes:
          - /var/lib/mysql:/var/lib/mysql
    
    ```

4. Let's Test

    ```sh
    docker compose -f /opt/finance/docker-compose.yml
    ```
5. Test using the command:

   ```sh
   curl -I "stapp03:8084"

   If result is 200 it is running properly
   Checkout output as well

   curl "stapp03:8084"
   ```
