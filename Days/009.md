# Day 9 ‚Äì MariaDB Production Issue Troubleshooting (KodeKloud)

Incident Scenario

There is a critical issue in the Nautilus application in Stratos DC.
The production support team identified that the application is unable to connect to the database.
After investigation, it was found that the MariaDB service is down on the database server.

## Objective

- Identify why MariaDB is not starting

- Fix the root cause

- Restore the database service

- Ensure the application can connect to the database again

## Troubleshooting Approach

Golden Rule: If a service fails ‚Üí Check status ‚Üí Check logs ‚Üí Fix root cause**

## Step-by-Step Investigation

1. Check MariaDB Service Status
```bash
systemctl status mariadb
```

# Result: Service was not running and showed startup errors.

2. Check Detailed Logs
```bash
journalctl -u mariadb -n 100
```

Errors found:

InnoDB: Operating system error number 13
Permission denied
Cannot open datafile './ibtmp1'

3. Identify Root Cause

Checked the MariaDB data directory:

```bash
ls -ld /var/lib/mysql
```

Output:

drwxr-xr-x root mysql /var/lib/mysql


Problem:

Owner = root

MariaDB runs as user = mysql

MySQL user had no write permission to its own data directory
So InnoDB could not create files and MariaDB crashed.

# Fix Implemented

4.Fix Ownership and Permissions
```bash
sudo chown -R mysql:mysql /var/lib/mysql
sudo chmod -R 755 /var/lib/mysql
```

5. Restart MariaDB
```bash
sudo systemctl restart mariadb
```

6. Verify Status

```
systemctl status mariadb
```

# Result:

Active: active (running)
Status: "Taking your SQL requests now..."


# MariaDB service successfully restored.

# üßæ Root Cause Summary**

MariaDB failed because /var/lib/mysql directory was owned by root instead of mysql.
The database process could not write its own data files, causing InnoDB to crash.


# Common issues to look for:

Permission denied
File not found
Port already in use
Configuration error

# Interview Q&A
Q1. If an application is not starting in Linux, what is the first thing you do?

Answer:
I check systemctl status <service> and then check logs using journalctl -u <service>.

Q2. How do you troubleshoot MariaDB not starting?

Answer:
Check service status ‚Üí Check logs ‚Üí Identify root cause (permission/config/port) ‚Üí Fix ‚Üí Restart ‚Üí Verify.

Q3. What caused the issue in this case?

Answer:
/var/lib/mysql was owned by root instead of mysql, so MariaDB could not write its data files.

Q4. What is /var/lib/mysql?

Answer:
It is the data directory where MariaDB stores database files.

Q5. What is the difference between chown and chmod?

Answer:
chown changes ownership, chmod changes permissions.

Q6. Why should database directories be owned by mysql user?

Answer:
Because MariaDB runs as mysql user and must have full access to its own data files for security and stability.

**‚≠ê Good to Know**

Most real production issues are due to:

Permissions
Disk space
Config errors
Port conflicts

**Important Linux paths:**

/var/log ‚Üí Logs
/var/lib/mysql ‚Üí DB data
/etc ‚Üí Configs

**Diagnostic Commands**
systemctl status mariadb: Service status
journalctl -u mariadb: Systemd logs
mysqladmin ping: Test connectivity
mysql -u root -p: Connect to database
