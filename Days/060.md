# Persistent Volumes in Kubernetes

The Nautilus DevOps team is working on a Kubernetes template to deploy a web application on the cluster. There are some requirements to create/use persistent volumes to store the application code, and the template needs to be designed accordingly. Please find more details below:

- Create a `PersistentVolume` named as `pv-xfusion`. Configure the `spec` as storage class should be `manual`, set capacity to `3Gi`, set access mode to `ReadWriteOnce`, volume type should be `hostPath` and set path to `/mnt/finance` (this directory is already created, you might not be able to access it directly, so you need not to worry about it).
- Create a `PersistentVolumeClaim` named as `pvc-xfusion`. Configure the spec as storage class should be `manual`, request `3Gi` of the storage, set access mode to `ReadWriteOnce`.
- Create a `pod` named as `pod-xfusion`, mount the persistent volume you created with claim name `pvc-xfusion` at document root of the web server, the container within the pod should be named as `container-xfusion` using image `httpd` with latest tag only (remember to mention the tag i.e `httpd:latest`).
- Create a node port type service named `web-xfusion` using node port `30008` to expose the web server running within the pod.

> Note: The kubectl utility on jump_host has been configured to work with the kubernetes cluster.

## Steps

1. Create a persistent volume `pv-datacenter.yaml` with below content:

    ```YAML
    apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: pv-datacenter
    spec:
      capacity:
        storage: 3Gi
      accessModes:
        - ReadWriteOnce
      storageClassName: manual
      hostPath:
        path: /mnt/finance
    ```

    > Create the volume:

    ```sh
    kubectl apply -f pv-datacenter.yaml
    ```

2. Create the persistent volume claim `pvc-datacenter.yaml` with this following content:

    ```YAML
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: pvc-datacenter
    spec:
      accessModes:
        - ReadWriteOnce
      storageClassName: manual
      resources:
        requests:
          storage: 2Gi
    ```

    To create the pvc:

    ```sh
    kubectl pvc-datacenter.yaml
    ```

3. Create the pod `pod-datacenter.yaml`:

    ```YAML
    apiVersion: v1
    kind: Pod
    metadata:
      name: pod-datacenter
      labels:
        app: pod-app
    spec:
      containers:
        - name: container-datacenter
          image: httpd:latest
          volumeMounts:
            - name: web-storage
              mountPath: /usr/local/apache2/htdocs
      volumes:
        - name: web-storage
          persistentVolumeClaim:
            claimName: pvc-datacenter
   
    ```

    > run the pod

    ```sh
    kubectl apply -f pod-datacenter.yaml
    ```

4. Create the service `web-datacenter-service.yaml` with below content:

    ```YAML
    apiVersion: v1
    kind: Service
    metadata:
      name: web-datacenter
    spec:
      type: NodePort
      selector:
        app: pod-app
      ports:
        - port: 80
          targetPort: 80
          nodePort: 30008
    ```

    ```sh
    kubectl apply -f web-datacenter-service.yaml
    ```
5. Verify the website is availiable from the portal link
